![Steam Friend Info](./Steam%20Friend%20Info.png)
# ðŸŽ® Steam Friend Infoï¼ˆè‡ªå‰ãƒ›ã‚¹ãƒˆç‰ˆï¼‰

Raspberry Pi 5 ã¾ãŸã¯ Linux ä»®æƒ³ãƒžã‚·ãƒ³ä¸Šã§å‹•ä½œã™ã‚‹ã€è»½é‡ãª Steam ãƒ•ãƒ¬ãƒ³ãƒ‰è¨˜éŒ²åˆ†æžã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Docker ã‚’ä½¿ç”¨ã—ã¦ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ã€‚ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã€Steam API Key ã‚’ç¬¬ä¸‰è€…ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒãªã„ãŸã‚ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’é‡è¦–ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æœ€é©ã§ã™ã€‚
  
ã‚¦ã‚§ãƒ–ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä¸Šã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¤ã„ã¦ã¯ã€æ—¥æœ¬èªžãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ã«æ©Ÿæ¢°ç¿»è¨³ã‚’é©ç”¨ã—ã¦ãŠã‚Šã¾ã™ãŒã€ã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿè¡Œã•ã‚Œã‚‹ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã¯é©ç”¨ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚
---

## ðŸŒŸ ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½

- âœ… **ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆã®å¤‰å‹•è¿½è·¡**ï¼ˆè¿½åŠ  / å‰Šé™¤ / ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å¤‰æ›´ï¼‰
- ðŸŒ **å›½åˆ¥çµ±è¨ˆåˆ†æž**ï¼ˆäººæ•°çµ±è¨ˆ + å›½åˆ¥åˆ†å¸ƒã‚°ãƒ©ãƒ•ï¼‰
- ðŸ•¹ï¸ **å®Ÿç¸¾é”æˆãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æž**ï¼ˆAppID ã‚’å…¥åŠ›ã—ã¦æ¤œç´¢å¯èƒ½ï¼‰
- ðŸŸ¢ **ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒœãƒ¼ãƒ‰**ï¼ˆèª°ãŒã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‹ã€æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“ã®è¡¨ç¤ºï¼‰
- ðŸ” **æ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**ï¼ˆå›½ã€ã‚¢ã‚¤ã‚³ãƒ³ã‚ã‚Šã€æœ€è¿‘ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ•°ãªã©ï¼‰
- ðŸ“ˆ **ãƒ¬ãƒ™ãƒ«æŽ¨ç§»ã‚°ãƒ©ãƒ•**
- ðŸ“‹ **ãƒ¬ãƒ™ãƒ«å¤‰åŒ–å±¥æ­´**
- ðŸ“ˆ **å®Ÿç¸¾ã¨ãƒ—ãƒ¬ã‚¤æ™‚é–“ã®ç·ãƒˆãƒ¬ãƒ³ãƒ‰**
- ðŸ“‹ **ã‚²ãƒ¼ãƒ ã”ã¨ã®1æ—¥ã‚ãŸã‚Šãƒ—ãƒ¬ã‚¤æ™‚é–“**
- ðŸ’¾ **è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— / ZIPã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ / ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜**
- ðŸ§ **Raspberry Pi 5 / Linux VMï¼ˆDebian / Ubuntuï¼‰ã§å®Ÿè¡Œå¯èƒ½**
- ðŸ³ **Docker ã«ã‚ˆã‚‹é«˜é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆRaspberry Pi 5 + SSDæŽ¨å¥¨ï¼‰**
- ðŸ”„ **Steamã‚²ãƒ¼ãƒ ãƒªã‚¹ãƒˆã‚’æ¯Žæ—¥è‡ªå‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥**

## âŒ éžå¯¾å¿œæ©Ÿèƒ½
- è¤‡æ•°ã® Steam ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- ãƒ•ãƒ¬ãƒ³ãƒ‰ã®ãƒ¬ãƒ™ãƒ«æƒ…å ±é–¢é€£ï¼ˆå€‹åˆ¥å–å¾—ã®ã¿ã€éžå¸¸ã«é…ã„ãŸã‚æœªå¯¾å¿œï¼‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£æƒ…å ±ï¼ˆãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚é–“ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚¦ã‚©ãƒ¼ãƒ«æƒ…å ±ï¼‰ï¼ˆâ€»Steam API ãŒæœªæä¾›ï¼‰

---

## âš™ï¸ æŽ¨å¥¨å‹•ä½œç’°å¢ƒ

ðŸ“¢ ä»¥ä¸‹ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å‹•ä½œç¢ºèªæ¸ˆã¿ï¼š

- âœ… Raspberry Pi 5ï¼ˆSSDæŽ¥ç¶šæŽ¨å¥¨ï¼‰
- âœ… VMWare / VirtualBox / Hyper-V ä¸Šã«æ§‹ç¯‰ã—ãŸ Debian / Ubuntuï¼ˆãƒ¡ãƒ¢ãƒª2GBä»¥ä¸ŠæŽ¨å¥¨ï¼‰
- ãã®ä»– Linuxï¼ˆSUSEã€CentOSã€RHELãªã©ï¼‰ã¯å€‹åˆ¥ã«è¨­å®šå¤‰æ›´ãŒå¿…è¦
- Windows WSL2ï¼ˆéžæŽ¨å¥¨ã€è¨­å®šèª¿æ•´ã‚„å‹•ä½œç¢ºèªãŒç…©é›‘ãªãŸã‚ã€è‡ªå·±è²¬ä»»ã§ï¼‰

---

## ðŸ’¡ è£œè¶³æ³¨æ„äº‹é …

- Steam ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€Œãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆå…¬é–‹ã€ã¨ã€Œã‚²ãƒ¼ãƒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå…¬é–‹ã€ãŒå¿…è¦ã§ã™ã€‚éžå…¬é–‹ã®å ´åˆã€ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã™ã€‚
- ã‚²ãƒ¼ãƒ æ‰€æŒæ•°ãŒéžå¸¸ã«å¤šã„å ´åˆï¼ˆæ•°åƒæœ¬ä»¥ä¸Šï¼‰ã€ã‚²ãƒ¼ãƒ åã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½œæ¥­ã«éžå¸¸ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ï¼ˆSteam API ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™ã‚ã‚Šï¼‰ã€‚åˆå›žã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Œäº†ã¾ã§ã¯ã‚·ã‚¹ãƒ†ãƒ ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¾Œã®ã‚²ãƒ¼ãƒ åã¯ Steam ä¸Šã§åç§°å¤‰æ›´ã•ã‚Œã¦ã‚‚è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã›ã‚“ã€‚å†ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¾ãŸã¯æ‰‹å‹•æ›´æ–°ãŒå¿…è¦ã§ã™ã€‚
- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆã¯10åˆ†ã”ã¨ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ã€‚ãƒ•ãƒ¬ãƒ³ãƒ‰æ•°ãŒéžå¸¸ã«å¤šã„å ´åˆã€cron job è¨­å®šã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
- ãƒ—ãƒ¬ã‚¤æ™‚é–“ã‚„ãƒ¬ãƒ™ãƒ«æŽ¨ç§»ã€å®Ÿç¸¾ãƒˆãƒ¬ãƒ³ãƒ‰ç­‰ã¯é•·æœŸé–“ã®ç¨¼åƒã«ã‚ˆã£ã¦åˆã‚ã¦æœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚
- å®Ÿç¸¾ãƒˆãƒ¬ãƒ³ãƒ‰ã‚°ãƒ©ãƒ•ã¯åˆæœŸæ®µéšŽã§ã¯æ­£ç¢ºã§ã¯ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ Steam API ãŒç›´è¿‘14æ—¥é–“ãƒ—ãƒ¬ã‚¤ã—ãŸã‚²ãƒ¼ãƒ ã—ã‹è¿”å´ã—ãªã„ä»•æ§˜ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚

## ç”»é¢ä¾‹ï¼šãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆ
![ãƒ›ãƒ¼ãƒ ç”»é¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼](./index.png)
## ç”»é¢ä¾‹ï¼šå›½åˆ¥åˆ†æž
![å›½åˆ¥åˆ†æž](./country.png)
## ç”»é¢ä¾‹ï¼šãƒ•ãƒ¬ãƒ³ãƒ‰ãƒˆãƒ¬ãƒ³ãƒ‰
![ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒˆãƒ¬ãƒ³ãƒ‰](./trend.png)
## ç”»é¢ä¾‹ï¼šãƒ•ãƒ¬ãƒ³ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒœãƒ¼ãƒ‰
![ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒœãƒ¼ãƒ‰](./status_board.png)
## ç”»é¢ä¾‹ï¼šå¤‰æ›´å±¥æ­´
ç›¸æ‰‹ãŒä½•åº¦åå‰ã‚’å¤‰ãˆã¦ã‚‚ã€èª°ã‹ä¸€ç›®ã§åˆ†ã‹ã‚‹
![å¤‰æ›´å±¥æ­´](./history.png)
## ç”»é¢ä¾‹ï¼šå®Ÿç¸¾é”æˆãƒˆãƒ¬ãƒ³ãƒ‰
![å®Ÿç¸¾é”æˆãƒˆãƒ¬ãƒ³ãƒ‰](./achievement_trend.png)
### AppIDã®å…¥åŠ›ãŒå¿…è¦
![appid](./appid.png)
### å˜ä¸€ã‚²ãƒ¼ãƒ ã®ãƒ—ãƒ¬ã‚¤æ™‚é–“æƒ…å ±ï¼ˆå¸¸æ™‚èµ·å‹•ãŒå¿…è¦ï¼‰
![game time](./game_play_time.png)

---

# ðŸ› ï¸ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ï¼ˆRaspberry Pi 5 8GBç‰ˆï¼‰

### 1. Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
cd
curl -sSL https://get.docker.com | sudo sh
sudo usermod -aG docker $USER
newgrp docker
```

### 2. Git Clone ã¾ãŸã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
#### Git Cloneã®å ´åˆ
```bash
sudo apt update;sudo apt upgrade -y
sudo apt install git -y
cd
git clone https://github.com/bbfox0703/steam-friend-history.git
cd steam-friend-history
cp .env.example .env
vi .env
```

### 3.1 .env ã®API KEYã¨IDã‚’ä¿®æ­£
Steam API KEY ã¨ Steamã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®64bit IDï¼ˆ76561xxxxxxxxxxxxï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
APIã‚­ãƒ¼å–å¾—å…ˆï¼šhttps://steamcommunity.com/dev/apikey

**ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆã‚„ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãŒéžå…¬é–‹ã ã¨å–å¾—ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚**

IDç¢ºèªæ–¹æ³•ï¼š
- Steamãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URLï¼ˆä¾‹ï¼šhttps://steamcommunity.com/profiles/7656119XXXXXXXXXXï¼‰â†’ ã“ã®æ•°å­—ãŒ SteamID64
- SteamDBï¼ˆhttps://steamdb.info/ï¼‰ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸
- https://steamid.io/ ã«IDã¾ãŸã¯URLã‚’å…¥åŠ›ã—ã¦ç¢ºèª

### 3.2 docker-compose.yml ã® DNSè¨­å®šã‚’è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦ä¿®æ­£

### 4. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
```bash
COMPOSE_BAKE=true docker compose build
docker compose up -d
```

### 5. ãƒªãƒã‚¸ãƒˆãƒªæ›´æ–°
```bash
docker compose down
#ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ›´ã‚’ç„¡è¦–ã™ã‚‹å ´åˆï¼š
#git reset --hard
git pull
COMPOSE_BAKE=true docker compose build
docker compose up -d
```

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†å¾Œã®ã‚¢ã‚¯ã‚»ã‚¹URL
http://ã‚µãƒ¼ãƒãƒ¼IPã‚¢ãƒ‰ãƒ¬ã‚¹:3000

ä¾‹ï¼šIPãŒ192.168.1.100ãªã‚‰  
http://192.168.1.100:3000

## æ‰‹å‹•ã§ã‚²ãƒ¼ãƒ ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹æ–¹æ³•

é€šå¸¸ã¯11:05AMã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ãŒã€æ‰‹å‹•ã§ã‚‚å®Ÿè¡Œå¯èƒ½ã§ã™ã€‚

### ã‚³ãƒ³ãƒ†ãƒŠåã®å–å¾—
```bash
docker ps
```
![docker ps](./docker_ps.png)

### docker bash å®Ÿè¡Œ
ã‚³ãƒ³ãƒ†ãƒŠåã‚’è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´
```bash
docker exec -it steam-friend-history-web-1 /bin/bash
cd /app
PYTHONPATH="." python3 utils/cache_games.py --lang all --sleep 1
```
å•é¡Œãªã‘ã‚Œã°ã‚²ãƒ¼ãƒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒé–‹å§‹ã•ã‚Œã¾ã™  
![Cache game](./cache_game.png)
- ã‚²ãƒ¼ãƒ 1æœ¬ã‚ãŸã‚Šç´„10ã€œ15ç§’ã‹ã‹ã‚Šã¾ã™
- åˆå›žã¯å¿…ãšã™ã¹ã¦å®Œäº†ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- 2å›žç›®ä»¥é™ã¯ä¸è¶³åˆ†ã®ã¿æ›´æ–°
- ã‚²ãƒ¼ãƒ åå¤‰æ›´ã¯è‡ªå‹•åæ˜ ã•ã‚Œã¾ã›ã‚“

å®Ÿç¸¾ãƒˆãƒ¬ãƒ³ãƒ‰ã‚°ãƒ©ãƒ•ä½œæˆã®ãŸã‚ã«ã‚²ãƒ¼ãƒ ãƒªã‚¹ãƒˆãŒå¿…è¦ã§ã™ã€‚  
![Game search](./game_search.png)

---

# VMwareä¸Šã®Debian OS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¾‹

### rootæ¨©é™ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’sudoã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ï¼ˆä¾‹ï¼šadmin01ï¼‰
```bash
su -
usermod -aG sudo admin01
```

### sudoæ¨©é™ã®ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ä½œæ¥­ï¼ˆå†ãƒ­ã‚°ã‚¤ãƒ³å¿…è¦ï¼‰
```bash
sudo apt update;sudo apt upgrade -y
sudo apt install open-vm-tools -y
sudo apt install git curl -y
cd
curl -sSL https://get.docker.com | sudo sh
sudo apt-get install -y uidmap
dockerd-rootless-setuptool.sh install
id -u
```
å‡ºåŠ›ã•ã‚ŒãŸæ•°å­—ï¼ˆä¾‹ï¼š1000ï¼‰ã‚’ãƒ¡ãƒ¢

```bash
vi .bashrc
```
ä»¥ä¸‹ã‚’è¿½åŠ ï¼š  
```bash
export PATH=/usr/bin:$PATH
export DOCKER_HOST=unix:///run/user/1000/docker.sock
```

æ•°å­—ã¯idã‚³ãƒžãƒ³ãƒ‰ã§å–å¾—ã—ãŸã‚‚ã®ã«åˆã‚ã›ã‚‹ã€‚

```bash
sudo loginctl enable-linger admin01
source ~/.bashrc
```

### Dockerå‹•ä½œç¢ºèª
```bash
docker version
docker info
docker run hello-world
```
![Hello Docker](./hello_docker.png)

```bash
cd
git clone https://github.com/bbfox0703/steam-friend-history.git
cd steam-friend-history
cp .env.example .env
vi .env
```
### ä»¥é™ã¯ Raspberry Pi 5 ã®æ‰‹é †3.1ä»¥é™ã«ç¶šã  
[ã“ã¡ã‚‰ã«ã‚¸ãƒ£ãƒ³ãƒ—](#31-envã®apikeyã¨idã‚’ä¿®æ­£)

---

## ä¸€éƒ¨Dockerã‚³ãƒžãƒ³ãƒ‰é›†

### ã‚³ãƒ³ãƒ†ãƒŠçŠ¶æ…‹ç¢ºèª
```bash
docker ps
```

### ã‚³ãƒ³ãƒ†ãƒŠã«bashã§å…¥ã‚‹
```bash
docker exec -it steam-friend-history-web-1 /bin/bash
```

### cronã‚¸ãƒ§ãƒ–ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
```bash
docker exec steam-friend-history-web-1 sh -c "ps aux | grep cron"
```

### cronã‚¸ãƒ§ãƒ–ã‚¤ãƒ³ãƒãƒ¼ãƒˆç¢ºèª
```bash
docker exec -it steam-friend-history-web-1 cat /etc/cron.d/steam-friend-cron
```

## ãƒ•ãƒ¬ãƒ³ãƒ‰æƒ…å ±æ›´æ–°é »åº¦ã‚’å¤‰æ›´ã™ã‚‹ã«ã¯

cronã‚¸ãƒ§ãƒ–ãƒ•ã‚¡ã‚¤ãƒ« `steam-friend-cron` ã®æœ€åˆã®è¡Œã‚’ç·¨é›†ã—ã¦å¤‰æ›´ã—ã¾ã™ã€‚  
ä¾‹ï¼‰`*/10` ã¯10åˆ†ã”ã¨ã«å®Ÿè¡Œ  
å¤‰æ›´å¾Œã¯Dockerå†èµ·å‹•ãŒå¿…è¦ã§ã™ã€‚
```bash
*/10 * * * * root /app/cronjob/update.sh >> /var/log/cron_exec.log 2>&1
0 * * * * root echo "âœ… Ping cron at $(date)" >> /var/log/cron_exec.log
```
