<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{% block title %}{{ _('Steam å¥½å‹å·¥å…·') }}{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- ğŸ”— åŠŸèƒ½å°èˆªå€ -->
	<div class="menu-bar">
		{% set current_path = request.path %}
		{% set pages = [
			('/', _('å¥½å‹æ¸…å–®')),
			('/history', _('è®Šæ›´ç´€éŒ„')),
			('/country', _('åœ‹åˆ¥åˆ†æ')),
			('/country-chart', _('åœ‹åˆ¥çµ±è¨ˆåœ–')),
			('/trend', _('å¥½å‹è¶¨å‹¢åœ–')),
			('/status-board', _('å¥½å‹ç‹€æ…‹çœ‹æ¿')),
			('/achievement', _('æˆå°±æŸ¥è©¢')),
			('/filter', _('æ¢ä»¶ç¯©é¸')),
			('/level-trend', _('ç­‰ç´šè¶¨å‹¢åœ–')),
			('/level-history', _('ç­‰ç´šè®ŠåŒ–ç´€éŒ„')),
			('/achievement-trend-overall', _('æˆå°±ç¸½è¶¨å‹¢')),
			('/backups', _('å‚™ä»½ç®¡ç†')),
			('/update', _('æ›´æ–°è³‡æ–™ï¼ˆèƒŒæ™¯æœ‰è‡ªå‹•å®šæœŸæ›´æ–°ï¼‰'))
		] %}
		{% for url, title in pages %}
			<a href="{{ url }}" class="menu-link {% if current_path == url %}active{% endif %}">{{ title }}</a>
		{% endfor %}
	</div>

    {% block content %}{% endblock %}

    {% block extra_script %}
    <script>
    function getPreferredLang() {
        const langs = navigator.languages || [navigator.language || 'en'];
        for (const lang of langs) {
            const l = lang.toLowerCase();
            if (l.includes('zh-tw')) return 'zh-TW';
            if (l.includes('ja')) return 'ja';
        }
        return 'en';
    }
    document.documentElement.lang = getPreferredLang();

    function formatLocalTime(ts) {
        const date = new Date(ts * 1000);
        return date.toLocaleString(document.documentElement.lang, {
            year: 'numeric',
            month: 'numeric',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hourCycle: 'h23'
        });
    }
    function formatAgo(ts) {
        const now = new Date();
        const then = new Date(ts * 1000);
        const diff = Math.floor((now - then) / 1000);
        if (diff < 60) return `${diff} {{ _('ç§’å‰') }}`;
        if (diff < 3600) return `${Math.floor(diff / 60)} {{ _('åˆ†é˜å‰') }}`;
        if (diff < 86400) return `${Math.floor(diff / 3600)} {{ _('å°æ™‚å‰') }}`;
        return `${Math.floor(diff / 86400)} {{ _('å¤©å‰') }}`;
    }
    function updateAllTimestamps() {
        document.querySelectorAll('.datetime-auto').forEach(el => {
            const ts = parseInt(el.dataset.timestamp, 10);
            if (!isNaN(ts)) {
                el.innerText = formatLocalTime(ts) + 'ï¼ˆ' + formatAgo(ts) + 'ï¼‰';
            }
        });
    }
    document.addEventListener('DOMContentLoaded', updateAllTimestamps);
    </script>
    {% endblock %}
</body>
</html>
