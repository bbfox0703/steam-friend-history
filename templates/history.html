<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>歷史變更紀錄</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h2>好友暱稱變更紀錄</h2>
    {% if name_history %}
        <ul>
        {% for sid, logs in name_history.items() %}
            <li>
                <strong><a href="https://steamcommunity.com/profiles/{{ sid }}" target="_blank">{{ sid }}</a></strong>
                <ul>
                {% for record in logs %}
                    <li>{{ record.time }}：{{ record.old }} → {{ record.new }}</li>
                {% endfor %}
                </ul>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>暫無暱稱變更紀錄。</p>
    {% endif %}

	<h2>好友增減紀錄</h2>
	<ul>
	{% for timestamp, change in changes|dictsort(reverse=true) %}
		<li>
			<strong>{{ timestamp }}</strong>
			{% if change.added %}
				<p>➕ 新增好友：</p>
				<ul>
				{% for sid in change.added %}
					{% set friend = friend_map.get(sid, {}) %}
					<li>
						<a href="https://steamcommunity.com/profiles/{{ sid }}" target="_blank">
							{{ friend.get("persona_name", sid) }}
						</a>
					</li>
				{% endfor %}
				</ul>
			{% endif %}

			{% if change.removed %}
				<p>➖ 移除好友：</p>
				<ul>
				{% for sid in change.removed %}
					{% set friend = friend_map.get(sid, {}) %}
					<li>
						<a href="https://steamcommunity.com/profiles/{{ sid }}" target="_blank">
							{{ friend.get("persona_name", sid) }}
						</a>
					</li>
				{% endfor %}
				</ul>
			{% endif %}
		</li>
	{% endfor %}
	</ul>
</body>
</html>
