
{% extends "base.html" %}

{% block title %}{{ _('Steam ç­‰ç´šç´€éŒ„') }}{% endblock %}

{% block content %}
<h2>{{ _('Steam ç­‰ç´šç´€éŒ„') }}</h2>

<button onclick="downloadCSV()" style="margin-bottom: 1em;">ðŸ“¥ {{ _('ä¸‹è¼‰å®Œæ•´è³‡æ–™ï¼ˆCSVï¼‰') }}</button>

<table>
  <thead>
    <tr>
      <th>{{ _('æ—¥æœŸ') }}</th>
      <th>{{ _('ç­‰ç´š') }}</th>
    </tr>
  </thead>
  <tbody>
    {% for date, level in recent_history %}
    <tr>
      <td>{{ date }}</td>
      <td>{{ level }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block extra_head %}
<style>
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1em;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
}
th {
  background: #f2f2f2;
}
</style>
{% endblock %}

{% block extra_script %}
<script>
const allData = {{ full_history | tojson }};

function downloadCSV() {
    let csvContent = "data:text/csv;charset=utf-8,{{ _('æ—¥æœŸ') }},{{ _('ç­‰ç´š') }}\n";
    for (const [date, level] of Object.entries(allData)) {
        csvContent += `${date},${level}\n`;
    }
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "level_history.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>
{% endblock %}
